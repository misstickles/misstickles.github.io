<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body>
<h2 id="playing-with-uk-covid-data">Playing with UK Covid data</h2>

<p>The source of all data in this script is the UK Government website, <a href="https://coronavirus.data.gov.uk/">https://coronavirus.data.gov.uk/</a>.</p>

<p>Now we can get a summary of the <code class="language-plaintext highlighter-rouge">cases</code> data:</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">summary</span><span class="p">(</span><span class="n">cases</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">##    areaCode           areaName           areaType              date           
##  Length:180605      Length:180605      Length:180605      Min.   :2020-01-30  
##  Class :character   Class :character   Class :character   1st Qu.:2020-07-04  
##  Mode  :character   Mode  :character   Mode  :character   Median :2020-10-31  
##                                                           Mean   :2020-10-30  
##                                                           3rd Qu.:2021-02-27  
##                                                           Max.   :2021-06-25  
##                                                                               
##  newCasesBySpecimenDate newDeaths28DaysByDeathDate
##  Min.   :   0.00        Min.   : 0.000            
##  1st Qu.:   2.00        1st Qu.: 0.000            
##  Median :   7.00        Median : 0.000            
##  Mean   :  25.82        Mean   : 0.737            
##  3rd Qu.:  25.00        3rd Qu.: 1.000            
##  Max.   :1701.00        Max.   :38.000            
##  NA's   :19             NA's   :15384</code></pre></figure>

<p>This shows that we have <em>162382</em> observations, with a dates between 2020-01-30 and 2021-06-25.</p>

<h3 id="wrangling-the-data">Wrangling the Data</h3>

<p>To aide simplicity, we first choose a selected number of areas for data to compare and wrangle the data slightly to provide what we’‘ll be needing.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">selected</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cases</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">areaName</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Crawley"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Mid Sussex"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Horsham"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="n">areaName</span><span class="p">,</span><span class="w"> </span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">newCasesBySpecimenDate</span><span class="p">,</span><span class="w"> </span><span class="n">newDeaths28DaysByDeathDate</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="w">
    </span><span class="n">cases7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rollmean</span><span class="p">(</span><span class="n">newCasesBySpecimenDate</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">na.pad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
    </span><span class="n">deaths7</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rollmean</span><span class="p">(</span><span class="n">newDeaths28DaysByDeathDate</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">na.pad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span></code></pre></figure>

<ol>
  <li>Filter our areas.  Just for local interest in this overview, we will look at Crawley, Horsham and Mid Sussex.</li>
  <li>Select the columns we are interested in.</li>
  <li>Mutate the data to add columns for 7-day Rolling Average of cases and deaths.</li>
</ol>

<h4 id="crudely-plot-our-data">Crudely Plot our Data</h4>

<p>Using the 7 day rolling average, to avoid a jagged chart, we show deaths and cases.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">selected</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">deaths7</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">areaName</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# Deaths (7 day rolling average)"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Death Date"</span><span class="p">)</span></code></pre></figure>

<p><img src="/figure/R/2021-05-14-covid-chart/deaths%20by%20date-1.png" alt="center"></p>

<p>The <code class="language-plaintext highlighter-rouge">Death Date</code> is the date of death, given that they had <strong>Covid-19</strong> within the past 28 days.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">selected</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">cases7</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">areaName</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span></code></pre></figure>

<p><img src="/figure/R/2021-05-14-covid-chart/unnamed-chunk-3-1.png" alt="center"></p>

<h3 id="chart-for-cases-and-deaths">Chart for Cases and Deaths</h3>

<p>Not the best way to display this data, but it shows the number of cases at a given time, and how the death rates followed the cases.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">selected</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">newCasesBySpecimenDate</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">areaName</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cases7</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">deaths7</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_log10</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="w">
    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# Cases"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Case Specimin Date"</span><span class="p">,</span><span class="w">
    </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"7 Day rolling average of cases and deaths in selected areas"</span><span class="w">
  </span><span class="p">)</span></code></pre></figure>

<p><img src="/figure/R/2021-05-14-covid-chart/7%20day%20cases%20and%20deaths-1.png" alt="center"></p>

<p>A boxplot with jitter to show the ‘range’ of data.  Notice that each area have a similar mean and quartile data.  Also that even the outliers are similar.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">selected</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">areaName</span><span class="p">,</span><span class="w"> </span><span class="n">newCasesBySpecimenDate</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">areaName</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_boxplot</span><span class="p">(</span><span class="n">outlier.shape</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">NA</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# Cases"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Area"</span><span class="p">,</span><span class="w"> </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Cases in selected areas"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.3</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w"> </span><span class="n">stroke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span></code></pre></figure>

<p><img src="/figure/R/2021-05-14-covid-chart/box%20plot%20cases-1.png" alt="Boxplot with jitter for cases in selected areas"></p>

<p>Maybe a better way would be to facet this data.  Unfortunately, at the moment, our data is not truely ‘tidy’.  In order to facet wrap, we need to tidy the <code class="language-plaintext highlighter-rouge">cases7</code> and <code class="language-plaintext highlighter-rouge">deaths7</code> columns.</p>

<p>“Tidy” data follows these rules:</p>

<ol>
  <li>Each variable in the data set is placed in its own column</li>
  <li>Each observation is placed in its own row</li>
  <li>Each value is placed in its own cell</li>
</ol>

<p><a href="https://garrettgman.github.io/tidying">https://garrettgman.github.io/tidying</a></p>

<p>Oh.  We need to turn</p>

<table>
  <thead>
    <tr>
      <th>areaName</th>
      <th>cases</th>
      <th>deaths</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>X</td>
      <td>10</td>
      <td>6</td>
    </tr>
  </tbody>
</table>

<p>into</p>

<table>
  <thead>
    <tr>
      <th>areaName</th>
      <th>ra7</th>
      <th>count_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>X</td>
      <td>10</td>
      <td>cases</td>
    </tr>
    <tr>
      <td>X</td>
      <td>6</td>
      <td>deaths</td>
    </tr>
  </tbody>
</table>

<p>so that each row provides us with a single observation.</p>

<p>We use <code class="language-plaintext highlighter-rouge">pivot_longer</code> to create columns <code class="language-plaintext highlighter-rouge">ra7</code> and <code class="language-plaintext highlighter-rouge">count_type</code> and populate it with death/case values and detail the data type.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">tidy</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">selected</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">newCasesBySpecimenDate</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">newDeaths28DaysByDeathDate</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">pivot_longer</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="n">cases7</span><span class="p">,</span><span class="w"> </span><span class="n">deaths7</span><span class="p">),</span><span class="w"> </span><span class="n">names_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"count_type"</span><span class="p">,</span><span class="w"> </span><span class="n">values_to</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"ra7"</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">tidy</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">ra7</span><span class="p">,</span><span class="w"> </span><span class="n">colour</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">areaName</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">(</span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">count_type</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loess</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">trans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"log10"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="w">
    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# Cases"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Case Specimin Date"</span><span class="p">,</span><span class="w">
    </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"7 Day rolling average of cases and deaths in selected areas"</span><span class="w">
  </span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## `geom_smooth()` using formula 'y ~ x'</code></pre></figure>

<p><img src="/figure/R/2021-05-14-covid-chart/7%20day%20cases%20and%20deaths%20faceted-1.png" alt="center"></p>

<h2 id="sum-across-the-uk">Sum Across the UK</h2>

<p>Just for fun, join everything together and sum cases across the UK…</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cases</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">cases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rollmean</span><span class="p">(</span><span class="n">newCasesBySpecimenDate</span><span class="p">,</span><span class="w"> </span><span class="m">7</span><span class="p">,</span><span class="w"> </span><span class="n">na.pad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">date</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">sum_cases</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">cases</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">sum_cases</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_line</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_log10</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="w">
    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"# Cases"</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Case Specimin Date"</span><span class="p">,</span><span class="w">
    </span><span class="n">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"7 day RA of positive cases in the UK"</span><span class="w">
  </span><span class="p">)</span></code></pre></figure>

<p><img src="/figure/R/2021-05-14-covid-chart/sum%20cases%20across%20UK-1.png" alt="center"></p>

<p>Using a logarithmic scale, we can clearly see just how high cases are still - and how quickly it took hold in March / April 2020.</p>

<h2 id="summary">Summary</h2>

<p>There are so many (better and correct) ways to present this data.  These charts are just a tiny amount of fun for my first ‘used in anger’ R script.</p>
</body></html>
